# when.toml - Example Configuration File

[audio.capture]
enabled = true
sample_rate = 48000
channels = 2
ring_frames = 8192
device = ""
input_gain = 1.0
system = true

[audio.file]
enabled = false
path = ""
channels = 1
gain = 1.0

[audio]
prefer_file = false

[dsp]
fft_size = 1024
hop_size = 256
bands = 32
window = "hann"
smoothing_attack = 0.2
smoothing_release = 0.05
beat_sensitivity = 1.0
enable_flux = true
apply_a_weighting = true
enable_spectral_flatness = true
enable_chroma = true
bass_onset_sensitivity = 2.0
mid_onset_sensitivity = 2.0
treble_onset_sensitivity = 1.4

[visual]
target_fps = 60.0

[runtime]
show_metrics = true
allow_resize = true
beat_flash = true
show_overlay_metrics = true

[plugins]
directory = "plugins"
autoload = ["beat-flash-debug"]
safe_mode = false

[[animations]]
type = "AsciiMatrix"
z_index = 2
initially_active = false
glyphs_file_path = "assets/ascii_matrix.txt"
matrix_rows = 12
matrix_cols = 40
matrix_show_border = true
matrix_beat_boost = 2.0
matrix_beat_threshold = 0.55

[[animations]]
type = "SpaceRock"
z_index = 3
initially_active = false
space_rock_spawn_base_count = 4
space_rock_spawn_strength_scale = 15.0
space_rock_square_lifespan_ms = 1600.0
space_rock_square_decay_rate = 1.0
space_rock_max_squares_floor = 14
space_rock_max_squares_scale = 42.0
space_rock_min_size = 0.08
space_rock_max_size = 0.32
space_rock_mid_beat_size_multiplier = 1.6
space_rock_bass_size_scale = 3.2
space_rock_treble_size_scale = 0.5
space_rock_treble_spawn_threshold = 0.1
space_rock_low_band_min_y = 0.6
space_rock_low_band_max_y = 0.95
space_rock_high_band_min_y = 0.05
space_rock_high_band_max_y = 0.4
space_rock_size_interp_rate = 3.5

[[animations]]
type = "Pleasure"
z_index = 3
initially_active = false
plane_rows = 24
plane_cols = 48
pleasure_magnitude_scale = 0.1
pleasure_history_smoothing = 0.18
pleasure_global_envelope_smoothing = 0.9 # higher for faster response
pleasure_profile_smoothing = 0.3
pleasure_ridge_magnitude_smoothing = 0.1
pleasure_ridge_position_smoothing = 0.95
pleasure_center_band_width = 0.42
pleasure_ridge_sigma = 0.06
pleasure_ridge_position_jitter = 0.1
pleasure_ridge_magnitude_jitter = 0.01
pleasure_ridge_interval_min = 0.3
pleasure_ridge_interval_max = 0.72
pleasure_min_ridges = 2
pleasure_max_ridges = 5
pleasure_line_spacing = 2
pleasure_max_lines = 48
pleasure_baseline_margin = 5
pleasure_max_upward_excursion = 30
pleasure_max_downward_excursion = 8

[[animations]]
type = "LightBrush"
z_index = 3
initially_active = true
light_brush_frame_fill_ratio = 0.82
light_brush_cell_aspect_ratio = 0.5
light_brush_frame_foreground_color = 240
light_brush_frame_background_color = 18
light_brush_particle_foreground_color = 255
light_brush_particle_background_color = 0
light_brush_heavy_velocity_min = 0.08
light_brush_heavy_velocity_max = 0.18
light_brush_light_velocity_min = 0.18
light_brush_light_velocity_max = 0.35
light_brush_heavy_lifespan_min = 1.1
light_brush_heavy_lifespan_max = 3.0
light_brush_light_lifespan_min = 0.6
light_brush_light_lifespan_max = 2.0
light_brush_speed_scale_min = 0.6
light_brush_speed_scale_max = 1.8
light_brush_turbulence_base_strength = 0.45
light_brush_attractor_radius = 0.42
light_brush_seeking_strength = 1.25
light_brush_thickness_min = 0.35
light_brush_thickness_max = 3.6
light_brush_thickness_smoothing = 0.16
light_brush_thickness_radius_scale = 1.35
light_brush_beat_weight_base = 0.5
light_brush_beat_weight_scale = 1.5
light_brush_tonal_weight_base = 0.6
light_brush_tonal_weight_scale = 0.8
light_brush_heavy_thickness_bias = 1.25
light_brush_light_thickness_bias = 0.9
light_brush_base_thickness_base = 0.5
light_brush_base_thickness_beat_scale = 1.6
light_brush_base_thickness_tonal_base = 0.6
light_brush_base_thickness_tonal_scale = 0.8

[[animations]]
type = "LightCycle"
z_index = 4
initially_active = false
light_cycle_base_speed = 0.32
light_cycle_energy_speed_scale = 0.6
light_cycle_tail_duration_s = 6.0
light_cycle_tail_fade_power = 2.1
light_cycle_turn_cooldown_s = 0.42
light_cycle_beat_turn_threshold = 0.5
light_cycle_energy_turn_threshold = 0.78
light_cycle_thickness_min = 0.85
light_cycle_thickness_max = 4.2
light_cycle_thickness_smoothing = 0.22
light_cycle_intensity_smoothing = 0.18
